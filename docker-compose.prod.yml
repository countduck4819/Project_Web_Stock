version: "3.9"

services:
    fireant_db:
        image: postgres:16
        container_name: fireant_db
        restart: always
        environment:
            POSTGRES_USER: countduck
            POSTGRES_PASSWORD: countduck
            POSTGRES_DB: fireant_stock
        volumes:
            - ./db:/var/lib/postgresql/data
        networks:
            - fireant_net

    fireant_python:
        build: ./python_data
        container_name: fireant_python
        restart: always
        working_dir: /fireant/python
        networks:
            - fireant_net
        ports:
            - "6060:6060"
        env_file:
            - .env
        command: ["python", "server.py"]

    fireant_api:
        build: ./api
        container_name: fireant_api
        restart: always
        working_dir: /fireant/api
        depends_on:
            - fireant_db
            - fireant_python
        networks:
            - fireant_net
        ports:
            - "3000:3000"
        env_file:
            - .env
        command: ["npm", "run", "start:prod"] # chạy bản dist

    fireant_web:
        build: ./web
        container_name: fireant_web
        restart: always
        working_dir: /fireant/web
        depends_on:
            - fireant_api
        networks:
            - fireant_net
        ports:
            - "7000:3000" # 7000 => public
        env_file:
            - .env
        command: ["npm", "run", "start"]

networks:
    fireant_net:
        driver: bridge
